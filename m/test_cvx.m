clc
clear all
close all


%%% Init variables OPF

R1 = .2
R2 = .2
R3 = .2
X1 = .01
X2 = .01
X3 = .01

A = [1, -1, 0, 0, 2*R1, 2*X1, -(R1^2 + R2^2),0,0,0,0,0,0,0,0;
    0,0,1,0,-1,0,0,1,0,-R1,1,1,0,-R2,0;
    0,0,0,1,0,-1,0,0,1,-X1,0,0,1,-X2,1
];

size(A)

c = [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

x0 = [1.000000,2.340000,0.320000,0.000000,0.000000,0.000000]
x1 = [1.000000,3.120000,0.130000,6.320000,0.710000,40.446495]
x2 = [1.000000,2.200000,0.230000,2.200000,0.230000,4.892900]
x3 = [1.000000,1.000000,0.350000,1.000000,0.350000,1.122500]

y10 = [1.000000,0.000000,0.000000,0.000000,0.000000,0.000000]
y11 = [1.000000,3.120000,0.130000,6.320000,0.7100000,40.446495]
y12 = [0.000000,0.000000,0.000000,2.200000,0.230000,4.892900]
y13 = [0.000000,0.000000,0.000000,1.000000,0.350000,1.122500]
y14 = [0.000000,0.000000,0.000000,0.000000,0.000000,0.000000]

%[v = 1.000000,p = 1.000000,q = 0.350000,P = 1.000000,Q = 0.350000,l = 1.122500]

mu11_P = y11(4) - x1(4)
mu11_Q = y11(5) - x1(5)
mu11_l = y11(6) - x1(6)
mu11_v = y11(1) - x1(1)
mu11_p = y11(2) - x1(2)
mu11_q = y11(3) - x1(3)
mu11 = horzcat(mu11_P,mu11_Q,mu11_l,mu11_v,mu11_p,mu11_q)


mu12_p = x1(2) - y12(2)
mu12_q = x1(3) - y12(3)
mu12_l = x1(6) - y12(6)
mu13_p = x1(2) - y13(2)
mu13_q = x1(3) - y13(3)
mu13_l = x1(6) - y13(6)
mu13=horzcat(mu12_p,mu12_q,mu12_l,mu13_p,mu13_q,mu13_l)

mu10 = x1(1) - y10(1)


a1=A(1,:)
a2=A(2,:)
a3=A(3,:)
y1 = ones(15,1)
y2 = ones(15,1)
y3 = ones(15,1)
y0 = horzcat(y01,y02,y03,y04)

x = 10*ones(15,1)


cost = c*x 

n=15
% Problem OPF: 
disp('Computing optimal solution for 2nd formulation...');
cvx_begin
    variable x2(n)
    variable Y(1,15) diagonal
    minimize( matrix_frac(A*x2 + b , eye(m) + B*Y*B') )
    a1*y1 == 0;
    a2*y2 == 0;
    a3*y3 == 0;
cvx_end
opt2 = cvx_optval;
